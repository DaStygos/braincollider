{% extends "base_generic.html" %}
{% load static %}

{% block content %}
<div class="container mt-5">
    <div class="card shadow p-4" style="max-width: 600px; margin: auto;">
        <h3 class="mb-4 text-center">Modifier le profil</h3>
        <form method="post" enctype="multipart/form-data">
            {% csrf_token %}

            <!-- Nom d'utilisateur -->
            <div class="mb-3">
                <label for="{{ user_form.username.id_for_label }}" class="form-label">Nom d'utilisateur</label>
                {{ user_form.username }}
            </div>

            <!-- Email -->
            <div class="mb-3">
                <label for="{{ user_form.email.id_for_label }}" class="form-label">Email</label>
                {{ user_form.email }}
            </div>

            <!-- Avatar -->
            <div class="mb-3">
                <label class="form-label d-block text-center mb-3">Photo de profil</label>
                <div class="d-flex justify-content-center gap-4">
                    <!-- Image actuelle -->
                    <div class="text-center">
                        <p class="small text-muted mb-2">Actuelle</p>
                        <div style="width: 120px; height: 120px; border-radius: 50%; overflow: hidden; background-color: #f0f0f0;">
                            <img 
                                src="{% if request.user.profile.avatar %}{{ request.user.profile.avatar.url }}{% else %}{% static 'images/default_avatar.png' %}{% endif %}"
                                alt="Avatar actuel"
                                style="width: 100%; height: 100%; object-fit: cover;">
                        </div>
                    </div>
                
                    <!-- Nouvelle image (cachée au début) -->
                    <div class="text-center" id="new-avatar-container" style="display: none;">
                        <p class="small text-muted mb-2">Nouvelle</p>
                        <div style="width: 120px; height: 120px; border-radius: 50%; overflow: hidden; background-color: #f0f0f0;">
                            <img id="new-avatar-preview" 
                                 src=""
                                 alt="Aperçu nouvel avatar"
                                 style="width: 100%; height: 100%; object-fit: cover;">
                        </div>
                    </div>
                </div>
            
                <!-- Input de fichier -->
                <div class="mt-3">
                    <input type="file" name="avatar" id="id_avatar" class="form-control">
                </div>
            </div>

            <div class="text-center mt-4">
                <button type="submit" class="btn btn-primary px-4">Enregistrer</button>
                <a href="{% url 'accounts:profile' %}" class="btn btn-secondary ms-2">Annuler</a>
            </div>
        </form>
    </div>
</div>

<!-- Apercu avatar -->
<script>
    const avatarInput = document.getElementById('id_avatar');
    const previewContainer = document.getElementById('new-avatar-container');
    const previewImage = document.getElementById('new-avatar-preview');

    avatarInput.addEventListener('change', function(event) {
        const file = event.target.files[0];

        if (file) {
            const reader = new FileReader();
            reader.onload = e => {
                previewImage.src = e.target.result;
                previewContainer.style.display = 'block';
            };
            reader.readAsDataURL(file);
        } else {
            previewImage.src = "";
            previewContainer.style.display = 'none';
        }
    });
</script>

{% endblock %}
